# YouTube Downloader Telegram Bot ‚Äî Design

## Summary

Telegram-–±–æ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ —Å YouTube. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É, –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç (–≤–∏–¥–µ–æ/–∞—É–¥–∏–æ) –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –±–æ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –≤ —á–∞—Ç. –ï—Å–ª–∏ —Ñ–∞–π–ª –±–æ–ª—å—à–µ 50 MB ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–∞–ø–∫—É –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞.

## User Flow

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç YouTube-—Å—Å—ã–ª–∫—É
2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç inline-–∫–Ω–æ–ø–∫–∏: `üé¨ –í–∏–¥–µ–æ` | `üéµ –ê—É–¥–∏–æ`
3. **–í–∏–¥–µ–æ** ‚Üí –≤—ã–±–æ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è: `360p` | `480p` | `720p` | `1080p`
4. **–ê—É–¥–∏–æ** ‚Üí —Å—Ä–∞–∑—É —Å–∫–∞—á–∏–≤–∞–µ—Ç MP3 (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
5. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `‚è≥ –°–∫–∞—á–∏–≤–∞—é...`
6. –§–∞–π–ª ‚â§ 50 MB ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram-—á–∞—Ç
7. –§–∞–π–ª > 50 MB ‚Üí –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –ø—É—Ç—ë–º
8. –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è

## Tech Stack

- **Python 3.11+**
- **python-telegram-bot[ext]** ~= 21.x ‚Äî Telegram Bot API
- **yt-dlp** ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ YouTube
- **python-dotenv** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env

## Architecture

–ú–æ–Ω–æ–ª–∏—Ç, –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ `asyncio.run_in_executor()`.

## Project Structure

```
youtubeDownloaderBot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ downloader.py        # –õ–æ–≥–∏–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (yt-dlp)
‚îÇ   ‚îî‚îÄ‚îÄ config.py            # –ó–∞–≥—Ä—É–∑–∫–∞ .env
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ docs/
‚îî‚îÄ‚îÄ logs/
```

## Configuration (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---|---|---|
| `BOT_TOKEN` | Telegram Bot Token | `123456:ABC-DEF...` |
| `ALLOWED_USERS` | Telegram ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | `123456789,987654321` |
| `YANDEX_DISK_PATH` | –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ | `/Users/user/YandexDisk/YouTube Downloads` |
| `DOWNLOAD_DIR` | –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ | `/tmp/yt_downloads` |
| `MAX_TELEGRAM_SIZE` | –õ–∏–º–∏—Ç —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö | `52428800` (50 MB) |

## Key Components

### downloader.py
- `get_video_info(url)` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã)
- `download_video(url, resolution)` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ (mp4)
- `download_audio(url)` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ (mp3)

### handlers.py
- URL detection (regex: `youtube.com/watch`, `youtu.be/`, `youtube.com/shorts/`)
- Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- Callback query handlers
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫

### config.py
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ `.env`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

## Access Control

–ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ Telegram ID (`ALLOWED_USERS`). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞¬ª.

## Error Handling

- –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí ¬´–≠—Ç–æ –Ω–µ YouTube-—Å—Å—ã–ª–∫–∞¬ª
- –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤–∏–¥–µ–æ ‚Üí ¬´–í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ¬ª
- –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ‚Üí ¬´–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å¬ª
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ whitelist ‚Üí ¬´–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞¬ª

## Deployment

- –ó–∞–ø—É—Å–∫ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º Mac –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º venv
- –ù–µ –¥–æ–ª–∂–µ–Ω –≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ 4 –±–æ—Ç–∞ –Ω–∞ —ç—Ç–æ–π –º–∞—à–∏–Ω–µ
- –í –±—É–¥—É—â–µ–º –≤–æ–∑–º–æ–∂–µ–Ω –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ DigitalOcean

## Decisions

- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** python-telegram-bot (–∑—Ä–µ–ª—ã–π, —Ö–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ:** yt-dlp –∫–∞–∫ Python-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–Ω–µ subprocess)
- **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã:** –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É (–Ω–µ API)
- **Async:** run_in_executor –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

# YouTube Downloader Bot (@mrYTDownloaderBot)

Telegram-бот для скачивания видео и аудио с YouTube. Отправляешь ссылку — бот предлагает выбрать формат и качество, скачивает файл и отправляет его прямо в чат. Если файл крупнее 50 МБ — автоматически сохраняет его на Яндекс.Диск.

**Автор:** Andreas Maier

---

## Возможности

- Скачивание видео с YouTube по ссылке (форматы: `youtube.com/watch?v=...`, `youtu.be/...`, `youtube.com/shorts/...`)
- Выбор формата: **видео (MP4)** или **аудио (MP3)**
- Выбор разрешения для видео: 360p, 480p, 720p, 1080p (показываются только доступные)
- Отправка файла прямо в Telegram-чат (до 50 МБ)
- Для файлов крупнее 50 МБ — автоматическое копирование в папку Яндекс.Диска с уведомлением в чате
- Whitelist — доступ только для разрешённых Telegram-пользователей

---

## Требования

- **Python 3.11+**
- **ffmpeg** — обязателен для слияния видео- и аудиопотоков (MP4) и конвертации в MP3; должен быть доступен в `PATH`
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))
- Telegram User ID разрешённых пользователей (узнать через [@userinfobot](https://t.me/userinfobot))
- Яндекс.Диск, смонтированный локально (для файлов крупнее 50 МБ)

Проверить наличие ffmpeg:
```bash
ffmpeg -version
```

---

## Установка

```bash
# 1. Клонировать репозиторий
git clone https://github.com/Dronnn/youtubeDownloaderBot.git
cd youtubeDownloaderBot

# 2. Создать и активировать виртуальное окружение
python3 -m venv venv
source venv/bin/activate

# 3. Установить зависимости
pip install -r requirements.txt

# 4. Настроить переменные окружения
cp .env.example .env
# Открыть .env и заполнить все значения (см. таблицу ниже)
```

---

## Конфигурация (.env)

| Переменная | Описание |
|---|---|
| `BOT_TOKEN` | Токен Telegram-бота — получить у [@BotFather](https://t.me/BotFather) |
| `ALLOWED_USERS` | Telegram ID разрешённых пользователей через запятую |
| `YANDEX_DISK_PATH` | Путь к локальной папке Яндекс.Диска для больших файлов |
| `DOWNLOAD_DIR` | Директория для временных файлов (по умолчанию `/tmp/yt_downloads`) |
| `MAX_TELEGRAM_SIZE` | Максимальный размер файла для отправки через Telegram в байтах (по умолчанию `52428800` = 50 МБ) |

---

## Запуск

```bash
source venv/bin/activate
python -m bot.main
```

---

## Деплой

Бот запускается на отдельном Mac в виртуальном окружении (`venv`). Зависимости Python изолированы в `venv`; ffmpeg устанавливается системно через Homebrew.

Рекомендуемый способ держать бота запущенным в фоне — `nohup` или системный LaunchAgent:

```bash
nohup python -m bot.main &> logs/bot.log &
```

---

## Использование

1. Отправить боту ссылку на YouTube-видео
2. Выбрать формат: **Видео** или **Аудио**
3. Для видео — выбрать разрешение из доступных (360p / 480p / 720p / 1080p)
4. Бот скачает файл и отправит его в чат
5. Если файл крупнее 50 МБ — файл будет скопирован в папку Яндекс.Диска, бот пришлёт путь к нему

### Команды

| Команда | Описание |
|---|---|
| `/start` | Приветствие и краткая инструкция |
| `/help` | Описание работы бота |

---

## Структура проекта

```
youtubeDownloaderBot/
├── bot/
│   ├── __init__.py
│   ├── main.py          # Точка входа, инициализация и запуск бота
│   ├── config.py        # Загрузка конфигурации из .env
│   ├── handlers.py      # Обработчики команд и inline callback-кнопок
│   └── downloader.py    # Скачивание через yt-dlp (видео и аудио)
├── docs/                # Документация и планы
├── logs/                # Логи разработки
├── .env.example         # Пример файла конфигурации
├── requirements.txt     # Python-зависимости
└── README.md
```
